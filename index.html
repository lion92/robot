<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arena Battle Royale 3D</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        *{margin:0;padding:0;box-sizing:border-box;}
        body{background:radial-gradient(ellipse at center,#1a1a2e 0%,#16213e 35%,#0f0f23 100%);
            color:#fff;font-family:'Orbitron',monospace;overflow:hidden;height:100vh;}
        #gameContainer{position:absolute;top:0;left:0;width:100%;height:100%;}
        .hud{position:fixed;top:10px;left:10px;z-index:100;background:rgba(0,0,0,0.8);padding:12px;border-radius:8px;
            border:2px solid #4ecdc4;}
        .hud h4{color:#00FF00;margin-bottom:5px;}
        .timer{position:fixed;top:10px;left:50%;transform:translateX(-50%);font-size:24px;font-weight:900;
            text-shadow:0 0 20px #4ecdc4;z-index:200;background:rgba(0,0,0,0.8);padding:8px 16px;border-radius:8px;
            border:2px solid #4ecdc4;display:none;}
        .leaderboard{position:fixed;top:10px;right:10px;background:rgba(0,0,0,0.8);padding:12px;border-radius:8px;
            border:2px solid #ffd700;min-width:200px;}
        .leaderboard h4{color:#ffd700;margin-bottom:8px;}
        .controls{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:12px;z-index:150;}
        .btn{padding:12px 24px;background:#222;border:2px solid #4ecdc4;color:#4ecdc4;font-family:inherit;font-weight:700;
            border-radius:8px;cursor:pointer;transition:all .3s;font-size:12px;}
        .btn:hover{background:#333;box-shadow:0 0 20px rgba(78,205,196,0.5);}
        .crosshair{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:20px;height:20px;
            border:2px solid rgba(255,255,255,0.7);border-radius:50%;pointer-events:none;}
        .crosshair::before,.crosshair::after{content:'';position:absolute;background:rgba(255,255,255,0.7);}
        .crosshair::before{width:2px;height:10px;top:50%;left:50%;transform:translate(-50%,-50%);}
        .crosshair::after{width:10px;height:2px;top:50%;left:50%;transform:translate(-50%,-50%);}
        .status-message{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:32px;font-weight:900;
            text-shadow:0 0 20px #ff6b6b;z-index:200;background:rgba(0,0,0,0.9);padding:20px 40px;border-radius:10px;
            border:3px solid #ff6b6b;display:none;text-align:center;}
    </style>
</head>
<body>
<div id="gameContainer"></div>
<div class="crosshair"></div>
<div class="hud"><h4>üéÆ JOUEUR</h4>
    Vie: <span id="playerHealth">120</span>/120<br>
    Kills: <span id="playerKills">0</span><br>
    Tirs: <span id="playerShots">0</span><br>
    Pr√©cision: <span id="playerAccuracy">0</span>%
</div>
<div class="timer" id="timer">5:00</div>
<div class="status-message" id="statusMessage"></div>
<div class="leaderboard"><h4>üèÜ CLASSEMENT</h4><div id="leaderboardContent"></div></div>
<div class="controls">
    <button class="btn" id="trainBtn">üöÄ ENTRA√éNER</button>
    <button class="btn" id="battleBtn" disabled>‚öîÔ∏è BATAILLE</button>
    <button class="btn" id="resetBtn">üîÑ RESET</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script>
    const CONFIG={ROBOTS:5,BATTLE_TIME:300,PLAYER_HP:120,ROBOT_HP:100,DAMAGE:25,PLAYER_SPEED:0.3,SHOOT_COOLDOWN:300,RESPAWN_TIME:3000,ARENA_SIZE:50};
    let gameState='idle',battleStartTime=0,animationId=null;
    let robots=[],projectiles=[],player=null;
    let keys={up:false,down:false,left:false,right:false,shoot:false},lastShot=0,mouseX=0,mouseY=0;
    let scene,camera,renderer,playerMesh,robotMeshes=[],projectileMeshes=[];

    function initThreeJS(){
        scene=new THREE.Scene();scene.fog=new THREE.Fog(0x000011,30,150);
        camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
        camera.position.set(0,20,30);
        renderer=new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(window.innerWidth,window.innerHeight);
        document.getElementById('gameContainer').appendChild(renderer.domElement);
        scene.add(new THREE.AmbientLight(0xffffff,0.5));
        const dirLight=new THREE.DirectionalLight(0xffffff,0.8);
        dirLight.position.set(50,100,50);scene.add(dirLight);
        const floor=new THREE.Mesh(new THREE.PlaneGeometry(CONFIG.ARENA_SIZE*2,CONFIG.ARENA_SIZE*2),new THREE.MeshLambertMaterial({color:0x001133}));
        floor.rotation.x=-Math.PI/2;scene.add(floor);
        const grid=new THREE.GridHelper(CONFIG.ARENA_SIZE*2,20,0x4ecdc4,0x4ecdc4);
        grid.material.opacity=0.2;grid.material.transparent=true;scene.add(grid);
        window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);});
        document.addEventListener('keydown',e=>{if(e.code==='KeyW')keys.up=true;if(e.code==='KeyS')keys.down=true;if(e.code==='KeyA')keys.left=true;if(e.code==='KeyD')keys.right=true;if(e.code==='Space')keys.shoot=true;});
        document.addEventListener('keyup',e=>{if(e.code==='KeyW')keys.up=false;if(e.code==='KeyS')keys.down=false;if(e.code==='KeyA')keys.left=false;if(e.code==='KeyD')keys.right=false;if(e.code==='Space')keys.shoot=false;});
        document.addEventListener('mousemove',e=>{if(document.pointerLockElement===document.body&&gameState==='battle'){mouseX+=e.movementX*0.002;mouseY=Math.max(-0.5,Math.min(0.5,mouseY+e.movementY*0.002));}});
        document.addEventListener('click',()=>document.body.requestPointerLock());
    }

    function initGame(){
        robots=[];projectiles=[];robotMeshes=[];projectileMeshes=[];
        scene.clear();initThreeJS();
        player={x:0,y:2,z:0,health:CONFIG.PLAYER_HP,maxHealth:CONFIG.PLAYER_HP,hits:0,shots:0,alive:true};
        playerMesh=new THREE.Mesh(new THREE.BoxGeometry(2,4,2),new THREE.MeshLambertMaterial({color:0x00ff00}));
        playerMesh.position.set(0,2,0);scene.add(playerMesh);
        for(let i=0;i<CONFIG.ROBOTS;i++){let angle=(i/CONFIG.ROBOTS)*Math.PI*2,radius=20;
            let robot={id:i,x:Math.cos(angle)*radius,y:1.5,z:Math.sin(angle)*radius,health:CONFIG.ROBOT_HP,alive:true,hits:0};
            robots.push(robot);
            let mesh=new THREE.Mesh(new THREE.BoxGeometry(2,3,2),new THREE.MeshLambertMaterial({color:Math.random()*0xffffff}));
            mesh.position.set(robot.x,robot.y,robot.z);robotMeshes.push(mesh);scene.add(mesh);}
    }

    function updateUI(){
        document.getElementById('playerHealth').textContent=Math.round(player.health);
        document.getElementById('playerKills').textContent=player.hits;
        document.getElementById('playerShots').textContent=player.shots;
        document.getElementById('playerAccuracy').textContent=player.shots>0?Math.round((player.hits/player.shots)*100):0;
        if(gameState==='battle'){
            let elapsed=Math.floor((Date.now()-battleStartTime)/1000);
            let rem=Math.max(0,CONFIG.BATTLE_TIME-elapsed);
            document.getElementById('timer').textContent=`${Math.floor(rem/60)}:${(rem%60).toString().padStart(2,'0')}`;
            if(rem<=0)endBattle();
        }
    }

    function movePlayer(){
        let fwd=new THREE.Vector3(Math.sin(mouseX),0,Math.cos(mouseX));
        let right=new THREE.Vector3(Math.cos(mouseX),0,-Math.sin(mouseX));
        if(keys.up){player.x+=fwd.x*CONFIG.PLAYER_SPEED;player.z+=fwd.z*CONFIG.PLAYER_SPEED;}
        if(keys.down){player.x-=fwd.x*CONFIG.PLAYER_SPEED;player.z-=fwd.z*CONFIG.PLAYER_SPEED;}
        if(keys.left){player.x-=right.x*CONFIG.PLAYER_SPEED;player.z-=right.z*CONFIG.PLAYER_SPEED;}
        if(keys.right){player.x+=right.x*CONFIG.PLAYER_SPEED;player.z+=right.z*CONFIG.PLAYER_SPEED;}
        playerMesh.position.set(player.x,player.y,player.z);playerMesh.rotation.y=mouseX;
        camera.position.lerp(new THREE.Vector3(player.x-Math.sin(mouseX)*15,player.y+10+mouseY*5,player.z-Math.cos(mouseX)*15),0.1);
        camera.lookAt(player.x,player.y+2,player.z);
    }

    function shoot(){
        if(keys.shoot&&Date.now()-lastShot>CONFIG.SHOOT_COOLDOWN){
            let dir=new THREE.Vector3(Math.sin(mouseX),0,Math.cos(mouseX));
            projectiles.push({x:player.x+dir.x*2,y:player.y,z:player.z+dir.z*2,vx:dir.x*1.2,vz:dir.z*1.2,owner:'player'});
            projectileMeshes.push(new THREE.Mesh(new THREE.SphereGeometry(0.3),new THREE.MeshBasicMaterial({color:0x00ff00})));
            projectileMeshes[projectileMeshes.length-1].position.set(player.x,player.y,player.z);
            scene.add(projectileMeshes[projectileMeshes.length-1]);player.shots++;lastShot=Date.now();
        }
    }

    function updateProjectiles(){
        for(let i=projectiles.length-1;i>=0;i--){
            let p=projectiles[i],m=projectileMeshes[i];
            p.x+=p.vx;p.z+=p.vz;m.position.set(p.x,p.y,p.z);
            robots.forEach((r,ri)=>{if(r.alive&&Math.hypot(r.x-p.x,r.z-p.z)<2){r.alive=false;player.hits++;scene.remove(robotMeshes[ri]);}});
            if(Math.abs(p.x)>CONFIG.ARENA_SIZE||Math.abs(p.z)>CONFIG.ARENA_SIZE){scene.remove(m);projectiles.splice(i,1);projectileMeshes.splice(i,1);}
        }
    }

    function startBattle(){
        gameState='battle';battleStartTime=Date.now();
        document.getElementById('timer').style.display='block';
        gameLoop();
    }

    function endBattle(){gameState='idle';document.getElementById('timer').style.display='none';cancelAnimationFrame(animationId);}
    function resetGame(){initGame();}

    function gameLoop(){
        if(gameState!=='battle')return;
        movePlayer();shoot();updateProjectiles();updateUI();
        renderer.render(scene,camera);animationId=requestAnimationFrame(gameLoop);
    }

    document.getElementById('trainBtn').onclick=()=>document.getElementById('battleBtn').disabled=false;
    document.getElementById('battleBtn').onclick=startBattle;
    document.getElementById('resetBtn').onclick=resetGame;
    initThreeJS();initGame();
</script>
</body>
</html>
